# 阶段1：核心架构优化与功能扩展

## 目标
优化现有架构，添加多种游戏模式和特殊食物系统，为后续功能扩展打下坚实基础。

## 学习目标
- 掌握 Kotlin 密封类和枚举类的高级用法
- 理解策略模式在游戏开发中的应用
- 学会设计可扩展的游戏架构
- 掌握状态管理的最佳实践

## 实施步骤

### 1. 创建游戏配置系统
**文件**: `GameConfig.kt`, `GameMode.kt`, `Difficulty.kt`
**目的**: 统一管理游戏配置，支持不同游戏模式和难度

### 2. 扩展食物系统
**文件**: 重构 `Food.kt`, 新增 `FoodType.kt`, `FoodEffect.kt`
**目的**: 实现多种食物类型和特殊效果

### 3. 实现游戏模式处理器
**文件**: `GameModeHandler.kt`
**目的**: 使用策略模式处理不同游戏模式的逻辑

### 4. 重构游戏引擎
**文件**: 更新 `SnakeGameEngine.kt`
**目的**: 集成新的配置系统和游戏模式

### 5. 更新视图模型
**文件**: 更新 `SnakeViewModel.kt`
**目的**: 支持新的游戏功能和状态管理

### 6. 更新UI组件
**文件**: 更新 `GameCanvas.kt`, `GameControls.kt`
**目的**: 渲染新的游戏元素和控制界面

## 技术要点

### 密封类的使用
```kotlin
sealed class GameState {
    data class Playing(val config: GameConfig) : GameState()
    data class Paused(val previousState: Playing) : GameState()
    data class GameOver(val finalScore: Int) : GameState()
}
```

### 策略模式实现
```kotlin
interface GameModeStrategy {
    fun handleMovement(snake: Snake, boundaries: Boundaries): Snake
    fun checkCollision(snake: Snake, boundaries: Boundaries): Boolean
}
```

### 枚举类的高级用法
```kotlin
enum class FoodType(
    val points: Int,
    val color: Color,
    val effectFactory: () -> FoodEffect?
) {
    REGULAR(1, Color.Red, { null }),
    BONUS(5, Color.Gold, { null }),
    SPEED_UP(2, Color.Blue, { SpeedUpEffect(3000L) })
}
```

## 检查清单
- [ ] 创建 GameConfig 数据类
- [ ] 实现 GameMode 枚举
- [ ] 创建 Difficulty 枚举
- [ ] 扩展 FoodType 枚举
- [ ] 实现 FoodEffect 接口和具体实现
- [ ] 创建 GameModeHandler 和策略实现
- [ ] 重构 SnakeGameEngine
- [ ] 更新 SnakeViewModel
- [ ] 更新 GameCanvas 渲染逻辑
- [ ] 测试所有新功能

## 预期成果
- 支持4种游戏模式：经典、无墙、障碍物、时间挑战
- 支持6种食物类型：普通、奖励、加速、减速、幽灵、缩小
- 可配置的游戏难度系统
- 更加模块化和可扩展的代码架构