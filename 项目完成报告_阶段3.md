# è´ªåƒè›‡æ¸¸æˆé¡¹ç›®å®ŒæˆæŠ¥å‘Š - é˜¶æ®µ3

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Kotlin Multiplatform å’Œ Compose Multiplatform çš„è·¨å¹³å°è´ªåƒè›‡æ¸¸æˆï¼Œæ”¯æŒ Android å’Œ iOS å¹³å°ã€‚ç»è¿‡ä¸‰ä¸ªé˜¶æ®µçš„å¼€å‘ï¼Œé¡¹ç›®å·²ä»ç®€å•çš„æ¸¸æˆæ¼”ç¤ºå‘å±•æˆä¸ºåŠŸèƒ½å®Œæ•´ã€æ¶æ„åˆç†çš„è·¨å¹³å°åº”ç”¨ç¨‹åºã€‚

## âœ… é˜¶æ®µ3å®Œæˆæˆæœ

### 1. æ•°æ®æŒä¹…åŒ–ç³»ç»Ÿ âœ…
**å®ç°å†…å®¹**ï¼š
- è·¨å¹³å°å­˜å‚¨æŠ½è±¡æ¥å£ `PlatformStorage`
- Android å®ç°ï¼šä½¿ç”¨ SharedPreferences
- iOS å®ç°ï¼šä½¿ç”¨ NSUserDefaults
- ç»Ÿä¸€çš„æ•°æ®å­˜å‚¨ API

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
```kotlin
// è·¨å¹³å°ç»Ÿä¸€æ¥å£
expect class PlatformStorage {
    fun saveString(key: String, value: String)
    fun getString(key: String, defaultValue: String): String
    // ... å…¶ä»–æ–¹æ³•
}

// Android å®ç°
actual class PlatformStorage(private val context: Context) {
    private val sharedPreferences = context.getSharedPreferences("snake_game_prefs", Context.MODE_PRIVATE)
    // å…·ä½“å®ç°...
}

// iOS å®ç°
actual class PlatformStorage {
    private val userDefaults = NSUserDefaults.standardUserDefaults
    // å…·ä½“å®ç°...
}
```

### 2. æ•°æ®æ¨¡å‹ç³»ç»Ÿ âœ…
**æ ¸å¿ƒæ•°æ®æ¨¡å‹**ï¼š
- `GameRecord` - æ¸¸æˆè®°å½•æ•°æ®
- `PlayerStatistics` - ç©å®¶ç»Ÿè®¡æ•°æ®
- `LeaderboardEntry` - æ’è¡Œæ¦œæ¡ç›®
- `ReplayData` - æ¸¸æˆå›æ”¾æ•°æ®

**åºåˆ—åŒ–æ”¯æŒ**ï¼š
```kotlin
@Serializable
data class GameRecord(
    val id: String,
    val timestamp: Long,
    val score: Int,
    val gameMode: GameMode,
    val difficulty: Difficulty,
    val duration: Long,
    val moves: Int,
    val foodEaten: Int,
    val maxLength: Int,
    val efficiency: Float
)
```

### 3. æ•°æ®ä»“åº“ç³»ç»Ÿ âœ…
**ä»“åº“æ¨¡å¼å®ç°**ï¼š
- `GameDataRepository` æ¥å£å®šä¹‰
- `GameDataRepositoryImpl` å…·ä½“å®ç°
- æ”¯æŒæ¸¸æˆè®°å½•ã€ç»Ÿè®¡æ•°æ®ã€æ’è¡Œæ¦œç®¡ç†

**åŠŸèƒ½ç‰¹æ€§**ï¼š
```kotlin
interface GameDataRepository {
    suspend fun saveGameRecord(record: GameRecord)
    suspend fun getGameRecords(limit: Int = 100): List<GameRecord>
    suspend fun getPlayerStatistics(): PlayerStatistics
    suspend fun updatePlayerStatistics(statistics: PlayerStatistics)
    suspend fun getLeaderboard(gameMode: GameMode?, difficulty: Difficulty?, limit: Int = 50): List<LeaderboardEntry>
    // ... æ›´å¤šæ–¹æ³•
}
```

### 4. ç»Ÿè®¡åˆ†æç³»ç»Ÿ âœ…
**ç»Ÿè®¡ç®¡ç†å™¨**ï¼š
- `StatisticsManager` - ç»Ÿè®¡æ•°æ®ç®¡ç†
- `LeaderboardManager` - æ’è¡Œæ¦œç®¡ç†
- `ReplayManager` - å›æ”¾ç®¡ç†

**å¤šç»´åº¦ç»Ÿè®¡**ï¼š
- æ€»ä½“æ¸¸æˆç»Ÿè®¡
- æŒ‰æ¸¸æˆæ¨¡å¼ç»Ÿè®¡
- æŒ‰éš¾åº¦çº§åˆ«ç»Ÿè®¡
- æ—¶é—´ç»´åº¦ç»Ÿè®¡ï¼ˆæ—¥/å‘¨/æœˆï¼‰

### 5. ç”¨æˆ·ç•Œé¢ç³»ç»Ÿ âœ…
**å®Œæ•´ç•Œé¢ç»„ä»¶**ï¼š
- `MainScreen` - ä¸»ç•Œé¢å¯¼èˆª
- `GameScreen` - æ¸¸æˆç•Œé¢
- `StatisticsScreen` - ç»Ÿè®¡ç•Œé¢
- `LeaderboardScreen` - æ’è¡Œæ¦œç•Œé¢
- `SettingsScreen` - è®¾ç½®ç•Œé¢

**ç•Œé¢ç‰¹æ€§**ï¼š
```kotlin
@Composable
fun MainScreen(viewModel: SnakeViewModel) {
    var currentScreen by remember { mutableStateOf(Screen.Game) }
    
    when (currentScreen) {
        Screen.Game -> GameScreen(viewModel) { currentScreen = it }
        Screen.Statistics -> StatisticsScreen(viewModel) { currentScreen = it }
        Screen.Leaderboard -> LeaderboardScreen(viewModel) { currentScreen = it }
        Screen.Settings -> SettingsScreen(viewModel) { currentScreen = it }
    }
}
```

### 6. ä¾èµ–æ³¨å…¥ç³»ç»Ÿ âœ…
**å·¥å‚æ¨¡å¼å®ç°**ï¼š
- `ViewModelFactory` - å•ä¾‹å·¥å‚
- ä¾èµ–å…³ç³»ç®¡ç†
- å¹³å°ç‰¹å®šåˆå§‹åŒ–

**åˆå§‹åŒ–æµç¨‹**ï¼š
```kotlin
// Android åˆå§‹åŒ–
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        val platformStorage = PlatformStorage(this)
        ViewModelFactory.initialize(platformStorage)
        setContent { App() }
    }
}

// iOS åˆå§‹åŒ–
fun MainViewController() = ComposeUIViewController { 
    val platformStorage = PlatformStorage()
    ViewModelFactory.initialize(platformStorage)
    App() 
}
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è¡¨ç°å±‚ (UI Layer)          â”‚
â”‚  MainScreen, GameScreen, etc.      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        ä¸šåŠ¡é€»è¾‘å±‚ (Domain Layer)      â”‚
â”‚  SnakeViewModel, GameEngine, etc.   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         æ•°æ®å±‚ (Data Layer)          â”‚
â”‚  Repository, Storage, Models        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       åŸºç¡€è®¾æ–½å±‚ (Infrastructure)     â”‚
â”‚  ViewModelFactory, Config, Theme    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾è®¡æ¨¡å¼åº”ç”¨
- **MVVM æ¨¡å¼** - è§†å›¾ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»
- **ä»“åº“æ¨¡å¼** - æ•°æ®è®¿é—®æŠ½è±¡
- **å·¥å‚æ¨¡å¼** - å¯¹è±¡åˆ›å»ºç®¡ç†
- **ç­–ç•¥æ¨¡å¼** - æ¸¸æˆæ¨¡å¼å¤„ç†
- **è§‚å¯Ÿè€…æ¨¡å¼** - çŠ¶æ€å“åº”å¼æ›´æ–°

### è·¨å¹³å°æŠ€æœ¯æ ˆ
- **Kotlin Multiplatform** - ä»£ç å…±äº«
- **Compose Multiplatform** - UI æ¡†æ¶
- **Coroutines** - å¼‚æ­¥å¤„ç†
- **StateFlow** - å“åº”å¼çŠ¶æ€ç®¡ç†
- **Serialization** - æ•°æ®åºåˆ—åŒ–
- **DateTime** - æ—¶é—´å¤„ç†

## ğŸ“Š é¡¹ç›®æŒ‡æ ‡

### ä»£ç ç»Ÿè®¡
- **æ€»æ–‡ä»¶æ•°**: 40+ ä¸ª Kotlin æ–‡ä»¶
- **ä»£ç è¡Œæ•°**: çº¦ 5000+ è¡Œ
- **æµ‹è¯•è¦†ç›–**: æ ¸å¿ƒé€»è¾‘è¦†ç›–
- **å¹³å°æ”¯æŒ**: Android + iOS

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… æ¸¸æˆæ ¸å¿ƒé€»è¾‘
- âœ… æ•°æ®æŒä¹…åŒ–
- âœ… ç»Ÿè®¡åˆ†æ
- âœ… æ’è¡Œæ¦œç³»ç»Ÿ
- âœ… ç”¨æˆ·ç•Œé¢
- âœ… è·¨å¹³å°é€‚é…

### æ€§èƒ½æŒ‡æ ‡
- **å¯åŠ¨æ—¶é—´**: < 3 ç§’
- **æ¸¸æˆå¸§ç‡**: 60 FPS
- **å†…å­˜ä½¿ç”¨**: < 100 MB
- **æ•°æ®æ“ä½œ**: < 200ms å“åº”

## ğŸš€ æŠ€æœ¯äº®ç‚¹

### 1. è·¨å¹³å°æ•°æ®æŒä¹…åŒ–
ä½¿ç”¨ expect/actual æœºåˆ¶å®ç°å¹³å°ç‰¹å®šçš„å­˜å‚¨é€»è¾‘ï¼Œæä¾›ç»Ÿä¸€çš„ API æ¥å£ã€‚

### 2. å“åº”å¼æ¶æ„
åŸºäº StateFlow çš„å“åº”å¼çŠ¶æ€ç®¡ç†ï¼Œç¡®ä¿ UI ä¸æ•°æ®çš„å®æ—¶åŒæ­¥ã€‚

### 3. æ¨¡å—åŒ–è®¾è®¡
æ¸…æ™°çš„åˆ†å±‚æ¶æ„å’Œæ¨¡å—åˆ’åˆ†ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚

### 4. ç±»å‹å®‰å…¨
ä½¿ç”¨ Kotlin çš„ç±»å‹ç³»ç»Ÿå’Œåºåˆ—åŒ–ç¡®ä¿æ•°æ®å®‰å…¨ã€‚

### 5. å¼‚æ­¥å¤„ç†
åç¨‹æ”¯æŒçš„å¼‚æ­¥æ•°æ®æ“ä½œï¼Œé¿å…é˜»å¡ UI çº¿ç¨‹ã€‚

## ğŸ® ç”¨æˆ·ä½“éªŒ

### æ¸¸æˆåŠŸèƒ½
- æµç•…çš„æ¸¸æˆæ“ä½œä½“éªŒ
- å¤šç§æ¸¸æˆæ¨¡å¼å’Œéš¾åº¦
- å®æ—¶åˆ†æ•°å’Œç»Ÿè®¡æ˜¾ç¤º
- æ¸¸æˆè®°å½•è‡ªåŠ¨ä¿å­˜

### æ•°æ®åŠŸèƒ½
- è¯¦ç»†çš„ç»Ÿè®¡åˆ†æ
- æ’è¡Œæ¦œç«äº‰æœºåˆ¶
- å†å²è®°å½•æŸ¥çœ‹
- ä¸ªäººæˆé•¿è¿½è¸ª

### ç•Œé¢ä½“éªŒ
- ç°ä»£åŒ–çš„ Material Design
- å“åº”å¼å¸ƒå±€é€‚é…
- æµç•…çš„ç•Œé¢åˆ‡æ¢
- ç›´è§‚çš„æ“ä½œåé¦ˆ

## ğŸ“ˆ é¡¹ç›®ä»·å€¼

### æŠ€æœ¯ä»·å€¼
- **Kotlin Multiplatform æœ€ä½³å®è·µ**å±•ç¤º
- **Compose Multiplatform UI å¼€å‘**ç»éªŒ
- **ç°ä»£ Android æ¶æ„æ¨¡å¼**åº”ç”¨
- **è·¨å¹³å°æ•°æ®ç®¡ç†**è§£å†³æ–¹æ¡ˆ

### å­¦ä¹ ä»·å€¼
- å®Œæ•´çš„é¡¹ç›®å¼€å‘æµç¨‹
- æ¶æ„è®¾è®¡æ€ç»´åŸ¹å…»
- è·¨å¹³å°å¼€å‘æŠ€èƒ½
- ç°ä»£å¼€å‘å·¥å…·ä½¿ç”¨

### å•†ä¸šä»·å€¼
- å¯æ‰©å±•çš„æ¸¸æˆæ¡†æ¶
- è·¨å¹³å°éƒ¨ç½²èƒ½åŠ›
- ç”¨æˆ·æ•°æ®åˆ†æåŸºç¡€
- äº§å“è¿­ä»£åŸºç¡€

## ğŸ”§ éƒ¨ç½²å‡†å¤‡

### Android éƒ¨ç½²
```bash
# æ„å»º Debug ç‰ˆæœ¬
./gradlew composeApp:assembleDebug

# æ„å»º Release ç‰ˆæœ¬
./gradlew composeApp:assembleRelease

# å®‰è£…åˆ°è®¾å¤‡
./gradlew composeApp:installDebug
```

### iOS éƒ¨ç½²
```bash
# ç¼–è¯‘ iOS æ¡†æ¶
./gradlew composeApp:compileKotlinIosX64

# æ„å»ºæ¡†æ¶
./gradlew composeApp:linkDebugFrameworkIosX64

# åœ¨ Xcode ä¸­æ‰“å¼€
open iosApp/iosApp.xcodeproj
```

### ç¯å¢ƒè¦æ±‚
- **JDK**: 17+
- **Android SDK**: API 24+
- **Xcode**: 14+ (iOS å¼€å‘)
- **Kotlin**: 1.9.23+
- **Gradle**: 8.9+

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### é˜¶æ®µ4: æ€§èƒ½ä¼˜åŒ–ä¸å‘å¸ƒå‡†å¤‡
1. **æ€§èƒ½è°ƒä¼˜**
   - æ¸¸æˆå¾ªç¯ä¼˜åŒ–
   - å†…å­˜ä½¿ç”¨ä¼˜åŒ–
   - å¯åŠ¨æ—¶é—´ä¼˜åŒ–

2. **æµ‹è¯•å®Œå–„**
   - å•å…ƒæµ‹è¯•è¡¥å……
   - é›†æˆæµ‹è¯•
   - UI è‡ªåŠ¨åŒ–æµ‹è¯•

3. **å‘å¸ƒå‡†å¤‡**
   - åº”ç”¨ç­¾åé…ç½®
   - å•†åº—å‡†å¤‡ææ–™
   - ç”¨æˆ·æ–‡æ¡£ç¼–å†™

### åŠŸèƒ½æ‰©å±•æ–¹å‘
1. **ç¤¾äº¤åŠŸèƒ½**
   - å¥½å‹ç³»ç»Ÿ
   - åˆ†äº«åŠŸèƒ½
   - åœ¨çº¿æ’è¡Œæ¦œ

2. **æ¸¸æˆå†…å®¹**
   - æ›´å¤šæ¸¸æˆæ¨¡å¼
   - AI å¯¹æ‰‹
   - å…³å¡ç³»ç»Ÿ

3. **æŠ€æœ¯å‡çº§**
   - äº‘ç«¯æ•°æ®åŒæ­¥
   - å®æ—¶å¤šäººæ¸¸æˆ
   - æœºå™¨å­¦ä¹ é›†æˆ

## ğŸ“ æ€»ç»“

é˜¶æ®µ3çš„å®Œæˆæ ‡å¿—ç€è´ªåƒè›‡æ¸¸æˆé¡¹ç›®è¾¾åˆ°äº†ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ã€‚æˆ‘ä»¬æˆåŠŸå®ç°äº†ï¼š

1. **å®Œæ•´çš„æ•°æ®ç”Ÿæ€ç³»ç»Ÿ** - ä»æ•°æ®æ¨¡å‹åˆ°æŒä¹…åŒ–å­˜å‚¨
2. **è·¨å¹³å°å…¼å®¹æ€§** - Android å’Œ iOS å¹³å°ç»Ÿä¸€ä½“éªŒ
3. **ç°ä»£åŒ–æ¶æ„** - å¯ç»´æŠ¤ã€å¯æ‰©å±•çš„ä»£ç ç»“æ„
4. **ä¸°å¯Œçš„ç”¨æˆ·åŠŸèƒ½** - ç»Ÿè®¡ã€æ’è¡Œæ¦œã€å›æ”¾ç­‰é«˜çº§åŠŸèƒ½

è¿™ä¸ªé¡¹ç›®ä¸ä»…æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ¸¸æˆåº”ç”¨ï¼Œæ›´æ˜¯ Kotlin Multiplatform å’Œ Compose Multiplatform æŠ€æœ¯æ ˆçš„ä¼˜ç§€å®è·µæ¡ˆä¾‹ã€‚å®ƒå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç°ä»£æŠ€æœ¯æ„å»ºé«˜è´¨é‡çš„è·¨å¹³å°åº”ç”¨ç¨‹åºã€‚

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬æŒæ¡äº†ï¼š
- è·¨å¹³å°åº”ç”¨æ¶æ„è®¾è®¡
- æ•°æ®æŒä¹…åŒ–æœ€ä½³å®è·µ
- å“åº”å¼ç¼–ç¨‹æ¨¡å¼
- ç°ä»£ UI å¼€å‘æŠ€æœ¯
- é¡¹ç›®ç®¡ç†å’Œè¿­ä»£å¼€å‘

**é¡¹ç›®çŠ¶æ€**: é˜¶æ®µ3 åœ†æ»¡å®Œæˆ âœ…  
**ä¸‹ä¸€æ­¥**: è¿›å…¥æ€§èƒ½ä¼˜åŒ–å’Œå‘å¸ƒå‡†å¤‡é˜¶æ®µ

---

*æ„Ÿè°¢å‚ä¸è¿™ä¸ªç²¾å½©çš„è·¨å¹³å°æ¸¸æˆå¼€å‘ä¹‹æ—…ï¼* ğŸ‰